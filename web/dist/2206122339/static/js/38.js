webpackJsonp([38],{"6hE4":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=a("3cXf"),o=a.n(l),r=a("FAA3"),i=a("38/s"),s=a("I29D"),n=a.n(s),d={data:function(){return{visible:!1,dataForm:{faultid:0,projectid:"",projectname:"",handlername:"",selectedprojectypeid:"",equipment:"",faulttype:"",faultdesc:"",starttime:"",networkstatus:"",faultstatus:"",declarer:"",plan:"",handlerid:"",remark:"",createtime:"",declartype:""},faulttypes:[],dataRule:{projectid:[{required:!0,message:"项目ID不能为空",trigger:"blur"}],projectname:[{required:!0,message:"项目名称不能为空",trigger:["blur","change"]}],faulttype:[{required:!0,message:"故障类型ID不能为空",trigger:"blur"}],faultdesc:[{required:!0,message:"故障问题描述不能为空",trigger:"blur"}],starttime:[{required:!0,message:"故障开始时间不能为空",trigger:"blur"}],faultstatus:[{required:!0,message:"故障状态(1 创建成功，2 已取消，3 已解决)不能为空",trigger:"blur"}],declarer:[{required:!0,message:"申报人ID不能为空",trigger:"blur"}],handlerid:[{required:!0,message:"项目负责人不能为空",trigger:"blur"}],remark:[{required:!0,message:"备注不能为空",trigger:"blur"}],createtime:[{required:!0,message:"创建时间不能为空",trigger:"blur"}],declartype:[{required:!0,message:"不能为空",trigger:"blur"}]},uploadformdata:new FormData,delfileIds:[],fileList:[]}},components:{selectView:r.default,selectHostView:i.default},methods:{init:function(t){var e=this;this.getDataList(400,410,this.initAuthstatusCallback),this.dataForm.faultid=t||0,this.visible=!0,this.$nextTick(function(){e.$refs.dataForm.resetFields(),e.dataForm.faultid&&e.$http({url:e.$http.adornUrl("/fenhuo/fenhuofault/info/"+e.dataForm.faultid),method:"get",params:e.$http.adornParams()}).then(function(t){var a=t.data;a&&0===a.code&&(e.dataForm.projectid=a.fenhuoFault.projectid,e.dataForm.projectname=a.fenhuoFault.projectname,e.dataForm.selectedprojectypeid=a.fenhuoFault.projectypeid,e.dataForm.equipment=a.fenhuoFault.equipment,e.dataForm.faulttype=a.fenhuoFault.faulttype,e.dataForm.faultdesc=a.fenhuoFault.faultdesc,e.dataForm.starttime=a.fenhuoFault.starttime,e.dataForm.networkstatus=a.fenhuoFault.networkstatus,e.dataForm.faultstatus=a.fenhuoFault.faultstatus,e.dataForm.declarer=a.fenhuoFault.declarer,e.dataForm.plan=a.fenhuoFault.plan,e.dataForm.handlerid=a.fenhuoFault.handlerid,e.dataForm.remark=a.fenhuoFault.remark,e.dataForm.createtime=a.fenhuoFault.createtime,e.dataForm.declartype=a.fenhuoFault.declartype,e.faultRelatedFilelist())})})},getDataList:function(t,e,a){this.loading=!0,this.$http({url:this.$http.adornUrl("/sys/config/queryrange"),method:"get",params:this.$http.adornParams({start:t,end:e})}).then(function(t){var e=t.data;a(e)})},initAuthstatusCallback:function(t){if(t&&0===t.code){console.log(o()(t)),this.authstatus=[];var e=0;if(this.faulttypes.length>0)return;for(e in t.config)this.faulttypes.push({value:t.config[e].paramKey,label:t.config[e].paramValue})}},dataFormSubmit:function(){var t=this;this.$refs.dataForm.validate(function(e){e&&t.$http({url:t.$http.adornUrl("/fenhuo/fenhuofault/"+(t.dataForm.faultid?"update":"save")),method:"post",data:t.$http.adornData({faultid:t.dataForm.faultid||void 0,projectid:t.dataForm.projectid,projectname:t.dataForm.projectname,hostid:t.dataForm.hostid,hostname:t.dataForm.hostname,equipment:t.dataForm.equipment,faulttype:t.dataForm.faulttype,faultdesc:t.dataForm.faultdesc,starttime:t.dataForm.starttime,networkstatus:t.dataForm.networkstatus,faultstatus:t.dataForm.faultstatus,declarer:t.dataForm.declarer,plan:t.dataForm.plan,handlerid:t.dataForm.handlerid,handlername:t.dataForm.handlername,remark:t.dataForm.remark,createtime:t.dataForm.createtime,declartype:t.dataForm.declartype})}).then(function(e){var a=e.data;a&&0===a.code?(t.submitUpload(a.faultid),t.$message({message:"操作成功",type:"success",duration:1500,onClose:function(){t.visible=!1,t.$emit("refreshDataList")}})):t.$message.error(a.msg)})})},selectedProjcetHandler:function(t){console.log(t),t.projectlist.projectname.length>0&&(this.dataForm.projectname=t.projectlist.projectname.join(","),this.dataForm.projectid=t.projectlist.id.join(","),this.dataForm.handlerid=t.projectlist.headerid.join(","),this.dataForm.handlername=t.projectlist.headername.join(","),this.dataForm.selectedprojectypeid=t.projectlist.projectypeid.join(","))},selectedZbxhostHandler:function(t){console.log(t),this.dataForm.equipment=t.zbxhostidlist.hostname.join(","),this.dataForm.hostid=t.zbxhostidlist.hostid.join(","),this.dataForm.hostname=t.zbxhostidlist.hostname.join(",")},deleteFileHandler:function(t,e){var a=void 0;for(a in this.fileList){var l=this.fileList[a];if(console.log("fileJson:"+o()(this.fileList[a])+",file uid:"+l.uid+", delUid:"+t),l.uid===t){this.dataForm.faultid&&"success"===l.status&&this.delfileIds.push(e);break}}a>-1&&this.fileList.splice(a,1),console.log("deleted filelist:"+o()(this.fileList))},faultRelatedFileDownload:function(t){var e=document.createElement("a"),a=this.$http.adornUrl("/fenhuo/fenhuofault/download?faultid="+this.dataForm.faultid+"&token="+this.$cookie.get("token")+"&fileName="+t);e.style.display="none",e.href=a,console.log(t),e.download=t,document.body.appendChild(e),e.click(),document.body.removeChild(e)},uploadfile:function(t){console.log(t),this.uploadformdata.append("files",t.file)},submitUpload:function(t){var e=this;this.uploadformdata=new FormData,this.$refs.upload.submit(),t?this.uploadformdata.append("deleteFiles",this.delfileIds):this.uploadformdata.append("deleteFiles",[]);n.a.post(this.$http.adornUrl("/fenhuo/fenhuofault/upload/"+t+"?token="+this.$cookie.get("token")),this.uploadformdata,{headers:{"Content-Type":"multipart/form-data"}}).then(function(t){e.fileList=[],console.log(t)}).catch(function(t){console.log(t)})},faultRelatedFilelist:function(){var t=this;this.$http({url:this.$http.adornUrl("/fenhuo/fenhuofault/faultfilelist/"+this.dataForm.faultid),method:"get"}).then(function(e){var a=e.data;a&&0===a.code?t.fileList=a.relatedfilelist:t.fileList=[]})},handlePreview:function(t){console.log("handlePreview:"+t)},onUploadStatuChange:function(t,e){this.fileList=e,console.log("onUploadStatuChange file: "+o()(t)+"!!--!!fileList: "+o()(e))},handleRemove:function(t,e){console.log("handleRemove file: "+o()(t)+"!!--!!fileList: "+o()(e))},uploadSuccess:function(t,e,a){console.log("-----------------------uploadSuccess-------------"),console.log("response:"+o()(t)),console.log("file:"+o()(e)),console.log("fileList:"+o()(a))}}},u={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:t.dataForm.faultid?"修改":"新增","close-on-click-modal":!1,visible:t.visible},on:{"update:visible":function(e){t.visible=e}}},[a("el-form",{ref:"dataForm",attrs:{model:t.dataForm,rules:t.dataRule,"label-width":"80px"},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.dataFormSubmit()}}},[a("el-form-item",{attrs:{label:"项目名称",prop:"projectname"}},[a("selectView",{attrs:{tabelTitle:"选择故障项目"},on:{selectedAction:t.selectedProjcetHandler}},[a("el-input",{attrs:{placeholder:"项目名称"},model:{value:t.dataForm.projectname,callback:function(e){t.$set(t.dataForm,"projectname",e)},expression:"dataForm.projectname"}})],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"故障类型"}},[a("el-select",{ref:"faulttype",staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:t.dataForm.faulttype,callback:function(e){t.$set(t.dataForm,"faulttype",e)},expression:"dataForm.faulttype"}},t._l(t.faulttypes,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),a("el-row",{directives:[{name:"show",rawName:"v-show",value:"600"==t.dataForm.selectedprojectypeid,expression:"dataForm.selectedprojectypeid=='600'?true:false"}]},[a("el-form-item",{attrs:{label:"故障主机",prop:"equipment"}},[a("selectHostView",{attrs:{tabelTitle:"选择故障主机",projectid:t.dataForm.projectid},on:{selectedAction:t.selectedZbxhostHandler}},[a("el-input",{attrs:{placeholder:"故障主机名称"},model:{value:t.dataForm.equipment,callback:function(e){t.$set(t.dataForm,"equipment",e)},expression:"dataForm.equipment"}})],1)],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"故障问题描述",prop:"faultdesc"}},[a("el-input",{attrs:{placeholder:"故障问题描述"},model:{value:t.dataForm.faultdesc,callback:function(e){t.$set(t.dataForm,"faultdesc",e)},expression:"dataForm.faultdesc"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"故障开始时间"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:t.dataForm.starttime,callback:function(e){t.$set(t.dataForm,"starttime",e)},expression:"dataForm.starttime"}})],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:6}},[a("el-container",[a("span",[a("h2",{staticStyle:{"line-height":"0px"}},[t._v("故障相关文件")])])])],1),t._v(" "),a("el-col",{attrs:{span:6,offset:12}},[a("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:"#","on-preview":t.handlePreview,"on-change":t.onUploadStatuChange,multiple:"","on-remove":t.handleRemove,"on-success":t.uploadSuccess,"file-list":t.fileList,"show-file-list":!1,"auto-upload":!1,"http-request":t.uploadfile}},[a("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[t._v("添加文件")])],1)],1)],1),t._v(" "),a("el-divider"),t._v(" "),a("ul",{staticClass:"infinite-list",staticStyle:{overflow:"auto"}},t._l(t.fileList,function(e){return a("el-row",{key:e.uid},[a("li",{staticClass:"infinite-list-item"},[a("el-col",{attrs:{span:8,offset:1}},[a("h3",[t._v(t._s(e.name))])]),t._v(" "),a("el-col",{attrs:{span:5,offset:10}},[t.dataForm.faultid?a("el-link",{attrs:{type:"primary",underline:!1},on:{click:function(a){t.faultRelatedFileDownload(e.name)}}},[t._v("下载")]):t._e(),t._v(" "),a("el-link",{attrs:{type:"primary",underline:!1},on:{click:function(a){t.deleteFileHandler(e.uid,e.name)}}},[t._v("删除")])],1)],1)])})),t._v(" "),a("el-form-item",{attrs:{label:"备注",prop:"remark"}},[a("el-input",{attrs:{placeholder:"备注"},model:{value:t.dataForm.remark,callback:function(e){t.$set(t.dataForm,"remark",e)},expression:"dataForm.remark"}})],1)],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.visible=!1}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.dataFormSubmit()}}},[t._v("确定")])],1)],1)},staticRenderFns:[]},m=a("46Yf")(d,u,!1,null,null,null);e.default=m.exports}});